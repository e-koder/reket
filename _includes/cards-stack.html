{% assign cardList = include.cards | split: "," %}
<div class="cards-stack" style="--cards: {{cardList.size}}">
	{%- for card in cardList -%}
	<div class="cards-stack-item" data-index="{{forloop.index}}" style="--index: {{forloop.index}}">
		<img src="/assets/images/cards/{{ card }}.svg" alt="{{ card }}" />
	</div>
	{%- endfor -%}
</div>

<script>

	let currentIndex = 1;
	let movement = 0;
	let totalCards = {{cardList.size}};

	let lastKnownScrollPosition = 0; 

	const container = document.querySelector('.cards-stack');

	const spacingVh = parseFloat(getComputedStyle(container).getPropertyValue('--space'));
	const cardVh = parseFloat(getComputedStyle(container).getPropertyValue('--card-height'));
	
	vhToPx = (value) => {
		return value * window.innerHeight / 100;
	}

	setCurrentActive = (index) => {
		const activeElement = document.querySelector(`.cards-stack-item.active`);
		const nextActiveElement = document.querySelector(`.cards-stack-item[data-index="${index}"]`);
		if (activeElement !== nextActiveElement) {
			currentIndex = index;
			document.querySelector(`.cards-stack-item.active`)?.classList.remove('active');
			document.querySelector(`.cards-stack-item[data-index="${index}"]`)?.classList.add('active');
		}
		
		
	}

	const spacing = vhToPx(spacingVh);
	const cardSize = vhToPx(cardVh);

	const emptySpaceSize = window.innerHeight - cardSize;

	setCurrentActive(1);

	document.addEventListener('scroll', (e) => {
		difference = window.scrollY - lastKnownScrollPosition;
		lastKnownScrollPosition = window.scrollY;
		console.log('a');
		const containerY = container.getBoundingClientRect().top;
		let activeIndex = Math.floor((-containerY + emptySpaceSize / 2) / spacing);
		if (activeIndex < 1) {
			activeIndex = 1;
		} else if (activeIndex > totalCards) {
			activeIndex = totalCards;
		}
		setCurrentActive(activeIndex);
	});

</script>